{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.9.96/css/materialdesignicons.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/index.css' %}">
    <link rel="stylesheet" href="{% static 'css/material-icon.css' %}">
    <script src="{% static 'js/index.js' %}"></script>
    <meta charset="UTF-8">
    <title>wang title</title>
</head>

<style>
    * {
        {% if not user.is_authenticated or use_default_theme %}
        --color-primary: #dfd9d6 !important;
        --color-accent: #dbc2d1;
        --color-background:#0a0a0a;
        {% else %}
        --color-primary: {{ theme.color_primary }} !important;
        --color-accent: {{ theme.color_accent }};
        --color-background: {{ theme.color_background }};
        {% endif %}
    }

    body {
        height: 100vh;
        {% if not user.is_authenticated or use_default_theme %}
        background: url("{% static 'img/background.png' %}") top!important;
        {% else %}
        background: url("{{ theme.background.url }}") top!important;
        {% endif %}
        background-size: cover!important;
    }

    #video-background {
        background-color: #000000;
    }
</style>

<body>
    <video autoplay loop id="video-background">
        {% if not user.is_authenticated or use_default_theme or theme.video.video.url == none %}
        <source src="{% static 'video/video.mp4' %}" type="video/mp4">
        {% else %}
        <source src="{{ theme.video.video.url }}" type="video/mp4">
        {% endif %}
    </video>

    <div id="mask"></div>

    <div class="container main-padding">
        <input type="text" class="meaqua-search-bar">
        <header>
            <p id="meaqua-time"></p>
            <div class="row">
                <div class="col-11">
                    <p id="meaqua-welcometext">Good night!</p>
                </div>
                <div class="col-1">
                    <p>So fucking cold</p>
                </div>
            </div>
            <p id="meaqua-applause">What about you, Takuya-kun? Please do your best to become happy for my sake. I am praying for your happiness from the bottom of my heart.</p id="meaqua-applause">
        </header>
        <h2 class="meaqua-section-headline">Applications</h2>
        <div class="row">
            <div class="col-3">
                <a href="https://github.com" target rel="noreferrer" class="app-card">
                    <div class="app-card-icon"><i class="mdi mdi-github" aria-hidden="true" style="font-size: 24px; vertical-align: middle"></i></div>
                    <div class="app-card-detail">
                        <h5>GitHub</h5>
                        <span>Oh man</span>
                    </div>
                </a>
            </div>
        </div>
        <h2 class="meaqua-section-headline">Bookmarks</h2>
        <div class="row">
            <div class="col-3 bookmark-card">
                <h3>Infrastructure</h3>
                <div class="bookmark-card-bookmark">
                    <a href="https://www.google.com" target rel="noreferrer">
                        <div class="bookmark-card-icon"><i class="mdi mdi-github" aria-hidden="true" style="font-size: 20px"></i></div> Google
                    </a>
                    <a href="https://www.google.com" target rel="noreferrer">
                        <div class="bookmark-card-icon"><i class="mdi mdi-github" aria-hidden="true" style="font-size: 20px"></i></div> Google
                    </a>
                </div>
            </div>
        </div>
    </div>

    {#Right bottom button#}
    <div class="position-absolute bottom-0 end-0" style="margin-bottom: 10px; margin-right: 10px;">
        <button type="button" id="video-control" class="btn btn-primary"><i class="mdi mdi-pause" aria-hidden="true" style="font-size: 24px"></i></button>
        <button type="button" id="video-mute" class="btn btn-primary"><i class="mdi mdi-volume-high" aria-hidden="true" style="font-size: 24px"></i></button>
        <button type="button" id="settings" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#settings-modal"><i class="mdi mdi-cog" aria-hidden="true" style="font-size: 24px"></i></button>
    </div>

    {# Left bottom show what's playing #}
    <div class="position-absolute bottom-0 start-0" style="margin-bottom: 10px; margin-left: 10px;">
        <div id="video-info">
            {% if not user.is_authenticated or use_default_theme or theme.video.name == none %}
            <p>Now playing : loveletter</p>
            {% else %}
            <p>Now playing : {{ theme.video.name }}</p>
            {% endif %}
            <p id="video-time"></p>
        </div>
    </div>

    {# Modal #}
    <div class="modal fade" id="settings-modal" tabindex="-1" aria-labelledby="settings-header" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content" style="background-color: var(--color-background)">
                <div class="modal-header">
                    <h5 class="modal-title" id="settings-header" style="color: var(--color-accent)">Settings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    {% if user.is_authenticated %}
                    <p>Logged in as {{ user.username }}</p>
                    {% else %}
                    <p>Not logged in</p>
                    {% endif %}

                    {% if not user.is_authenticated or use_default_theme %}
                    <p>Theme : Default</p>
                    {% else %}
                    <p>Theme : {{ theme.name }}</p>
                    {% endif %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</body>



<script>
    let datetime = document.getElementById('meaqua-time');
    let videoBackground = document.getElementById('video-background');
    let videoControl = document.getElementById('video-control');
    let videoMute = document.getElementById('video-mute');
    let videoTime = document.getElementById('video-time');
    let videoInfo = document.getElementById('video-info');
    const days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
    const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];

    updateTime();
    updateVideoTime();

    // update date and time every second
    setInterval(function() {
        updateTime();
    }, 1000);

    function updateTime() {
        let date = new Date();
        // format : MONDAY, 25 JULY 2022 - 00:11:00
        // if the hour, minute, second is less than 10, add a 0 before it
        let hour = date.getHours();
        let minute = date.getMinutes();
        let second = date.getSeconds();
        if (hour < 10) {
            hour = '0' + hour;
        }
        if (minute < 10) {
            minute = '0' + minute;
        }
        if (second < 10) {
            second = '0' + second;
        }
        datetime.innerHTML = days[date.getDay()] + ', ' + date.getDate() + ' ' + months[date.getMonth()] + ' ' + date.getFullYear() + ' - ' + hour + ':' + minute + ':' + second;
    }

    // if the video is not playing, change the transparency of video to 0 and change the background color to transparent
    setInterval(function() {
        if (videoBackground.paused) {
            document.getElementById('video-background').style.opacity = 0;
            document.getElementById('video-background').style.backgroundColor = 'transparent';
            videoInfo.style.display = 'none';
        } else {
            document.getElementById('video-background').style.opacity = 1;
            document.getElementById('video-background').style.backgroundColor = '#000000';
            videoInfo.style.display = 'block';
        }
    }, 1000);

    // video control button
    videoControl.addEventListener('click', function() {
        if (videoBackground.paused) {
            videoBackground.play();
            videoControl.innerHTML = '<i class="mdi mdi-pause" aria-hidden="true" style="font-size: 24px"></i>';
        } else {
            videoBackground.pause();
            videoControl.innerHTML = '<i class="mdi mdi-play" aria-hidden="true" style="font-size: 24px"></i>';
        }
    });

    // video mute button
    videoMute.addEventListener('click', function() {
        if (videoBackground.muted) {
            videoBackground.muted = false;
            videoMute.innerHTML = '<i class="mdi mdi-volume-high" aria-hidden="true" style="font-size: 24px"></i>';
        } else {
            videoBackground.muted = true;
            videoMute.innerHTML = '<i class="mdi mdi-volume-off" aria-hidden="true" style="font-size: 24px"></i>';
        }
    });

    function updateVideoTime() {
        // format : 00:00 / 00:00
        let time = videoBackground.currentTime;
        let duration = videoBackground.duration;
        let minute = Math.floor(time / 60);
        let second = Math.floor(time % 60);
        let durationMinute = Math.floor(duration / 60);
        let durationSecond = Math.floor(duration % 60);
        if (minute < 10) {
            minute = '0' + minute;
        }
        if (second < 10) {
            second = '0' + second;
        }
        if (durationMinute < 10) {
            durationMinute = '0' + durationMinute;
        }
        if (durationSecond < 10) {
            durationSecond = '0' + durationSecond;
        }
        videoTime.innerHTML = minute + ':' + second + ' / ' + durationMinute + ':' + durationSecond;
    }

    // update video time every second
    setInterval(function() {
        updateVideoTime();
    }, 1000);
</script>
</html>